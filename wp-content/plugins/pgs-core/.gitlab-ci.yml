stages:
  - test

before_script:
  - apt-get update
  - apt-get install -y unzip
  - php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
  - php composer-setup.php --install-dir=/usr/local/bin --filename=composer

php_7.4:
  stage: test
  image: php:7.4-cli
  script:
    - export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    - composer global require wp-coding-standards/wpcs
    - ln -s ~/.composer/vendor/bin/phpcs /usr/local/bin/phpcs
    - phpcs --config-set installed_paths ~/.composer/vendor/wp-coding-standards/wpcs
    - phpcs --standard=WordPress-Core .
  rules:
    - exists:

php_8.0:
  stage: test
  image: php:8.0-cli
  script:
    - export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    - composer global require wp-coding-standards/wpcs
    - ln -s ~/.composer/vendor/bin/phpcs /usr/local/bin/phpcs
    - phpcs --config-set installed_paths ~/.composer/vendor/wp-coding-standards/wpcs
    - phpcs --standard=WordPress-Core .
  rules:
    - exists:

php_8.1:
  stage: test
  image: php:8.1-cli
  script:
    - export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    - composer global require wp-coding-standards/wpcs
    - ln -s ~/.composer/vendor/bin/phpcs /usr/local/bin/phpcs
    - phpcs --config-set installed_paths ~/.composer/vendor/wp-coding-standards/wpcs
    - phpcs --standard=WordPress-Core .
  rules:
    - exists:

php_8.2:
  stage: test
  image: php:8.2-cli
  script:
    - export PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
    - composer global require wp-coding-standards/wpcs
    - ln -s ~/.composer/vendor/bin/phpcs /usr/local/bin/phpcs
    - phpcs --config-set installed_paths ~/.composer/vendor/wp-coding-standards/wpcs
    - phpcs --standard=WordPress-Core .
  rules:
    - exists:
