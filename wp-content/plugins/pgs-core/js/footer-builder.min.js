!function(r){"use strict";function a(){var e=r(".pgsfb-footer-column-setting").length,t=r(".pgsfb-footer-column-setting:visible").length,s=r("#pgsfb-footer-columns").val();if(e<s)for(var o=s-e,a=0;a<o;++a){var n=r("#pgsfb-column-settings-template").html(),i=r(".pgsfb-footer-column-setting:visible").length+1,n=n.replace(/{{column_index}}/g,i);r(".pgsfb-footer-column-settings").append(n)}else if(s<t){var l=t-s;for(a=0;a<l;++a)r(".pgsfb-footer-column-setting:visible").last().hide()}else if(t<s){var f=s-t;for(a=0;a<f;++a)r(".pgsfb-footer-column-setting:hidden").first().show()}}function n(){r(".pgsfb-elements-list .pgsfb-draggable-item").draggable({scroll:!1,cursor:"move",opacity:.7,stack:".pgsfb-draggable-item",helper:"clone"}),r(".pgsfb-droppable-active.pgsfb-element-droppable").droppable({accept:".pgsfb-elements-list .pgsfb-draggable-item",drop:function(e,t){var s=r(this),o=t.draggable,t=t.draggable.find(".pgsfb-element-content").data("element_id");s.hasClass("pgsfb-droppable-active")&&(s.find(".pgsfb-element-column-input").val(t),o.clone().appendTo(s),s.removeClass("pgsfb-droppable-active"),s.droppable("destroy"))}})}function e(){r(".pgsfb-field-option").each(function(){var e=r(".pgsfb-edit-tabs .pgsfb-tabs-title.pgsfb-tab-active").data("tab");r(this).data("content")==e?r(this).show():r(this).hide()}),t()}function t(){r("form#pgsfb-footer-settings :input").each(function(){var s,e,o;this.checked&&(s=r(this).val(),e=r(this).attr("name"),o=r(".pgsfb-edit-tabs .pgsfb-tabs-title.pgsfb-tab-active").data("tab"),r('[data-dependency-element="'+e+'"]').each(function(){var e=r(this).data("dependency-value"),t=r(this).data("content");-1==r.inArray(s,e)?r(this).hide():t==o&&r(this).show()}))})}r(document).ready(function(){a(),n(),t(),e();var s,o=r("#footer-columns-slider-handle");r("#pgsfb-footer-columns-slider").slider({max:12,value:r("#pgsfb-footer-columns").val(),create:function(){o.text(r(this).slider("value"))},slide:function(e,t){o.text(t.value),r("#pgsfb-footer-columns").val(t.value),a(),n()}}),r(document).on("click",".pgsfb-save",function(e){e.preventDefault();var e=r(".layout-title").val(),t=r(this).data("footer_id");if(e){r(".layout-title").removeClass("pgsfb-required"),r(".pgsfb-footer-column-setting:hidden").remove(),r("#wpwrap").append('<div class="pgsfb-overlay"></div>');var s,o,a,n=r("form#pgsfb-footer-settings").serializeArray();r("#wp-footer_text_left-wrap").hasClass("tmce-active")&&(s=tinymce.get("footer_text_left").getContent()),r("#wp-footer_text_right-wrap").hasClass("tmce-active")&&(o=tinymce.get("footer_text_right").getContent()),r("#wp-footer_bottom_content-wrap").hasClass("tmce-active")&&(a=tinymce.get("footer_bottom_content").getContent());for(var i=0;i<n.length;++i)s&&"footer_settings[common_settings][footer_text_left]"==n[i].name&&(n[i].value=s),o&&"footer_settings[common_settings][footer_text_right]"==n[i].name&&(n[i].value=o),a&&"footer_settings[common_settings][footer_bottom_content]"==n[i].name&&(n[i].value=a);n.push({name:"action",value:"save_footer_builder"},{name:"footer_settings[footer_id]",value:t}),r.ajax({type:"POST",url:ajaxurl,dataType:"json",encode:!0,data:n,success:function(e){var t;r(".pgsfb-overlay").remove(),e.redirect&&(t=r(location).attr("href"),t+="&footer_id="+e.footer_id,r(location).attr("href",t))}})}else r(".layout-title").addClass("pgsfb-required"),r("html, body").animate({scrollTop:r(".layout-title").offset().top-100},1e3)}),r(document).on("click",".footer-layout-clone",function(e){e.preventDefault();e=r(this).data("footer_id");e&&r.ajax({type:"POST",url:ajaxurl,data:{action:"clone_footer",footerId:e},dataType:"json",success:function(e){var t=r("ul.footer-layout-lists li").length,s=(t-=1,r(location)),s=s.attr("protocol")+"//"+s.attr("host")+s.attr("pathname");r("ul.footer-layout-lists > li:eq("+t+")").after('<li class="footer-layout-list-item"><div class="footer-layout-list-item-inner"><a href="'+s+"?page=footer-layout&footer_id="+e.footer_id+'">'+e.footer_title+'</a><div class="footer-layout-list-actions"><a href="'+s+"?page=footer-layout&footer_id="+e.footer_id+'" class="footer-layout-action footer-layout-edit"><span class="dashicons dashicons-edit"></span></a><a href="'+s+"?page=footer-layout&footer_id="+e.footer_id+'" class="footer-layout-action footer-layout-clone" data-footer_id="'+e.footer_id+'"><span class="dashicons dashicons-admin-page"></span></a><a href="'+s+"?page=footer-layout&footer_id="+e.footer_id+'" class="footer-layout-action footer-layout-delete" data-footer_id="'+e.footer_id+'"><span class="dashicons dashicons-trash"></span></a></div></li>')}})}),r(document).on("click",".footer-layout-delete",function(e){e.preventDefault();var e=r(this).data("footer_id"),t=r(this);e&&confirm(cfl.delete_footer_layout)&&r.ajax({type:"POST",url:ajaxurl,data:{action:"delete_footer",footerId:e},dataType:"json",success:function(e){t.parents("li").remove()}})}),r(document).on("click",".pgsfb-element-content .pgsfb-remove-btn",function(){confirm(cfl.delete_element)&&(r(this).parents(".pgsfb-element-column").find("input.pgsfb-element-column-input").val(""),r(this).parents(".pgsfb-element-droppable").addClass("pgsfb-droppable-active"),r(this).parents(".pgsfb-draggable-item").remove(),n())}),r(document).on("click",".pgsfb-edit-tabs .pgsfb-tabs-title",function(){r(this).hasClass("pgsfb-tab-active")||(r(".pgsfb-edit-tabs .pgsfb-tabs-title").removeClass("pgsfb-tab-active"),r(this).addClass("pgsfb-tab-active"),e())}),r(document).on("click",".pgsfb-remove-media-button",function(){var e=r(this).parents(".pgsfb-background-setting-field");e.find(".pgsfb-field-media-id").val(""),e.find(".pgsfb-field-media-src").val(""),e.find(".pgsfb-field-media-cover img").attr("src",""),e.find(".pgsfb-field-media-cover").addClass("hidden"),r(this).addClass("hidden")}),r(document).on("click",".media-upload",function(e){e.preventDefault();var t=r(this).parents(".pgsfb-background-setting-field");s||(s=wp.media.frames.file_frame=wp.media({title:cfl.choose_image,button:{text:cfl.choose_image,close:!0},multiple:!1})).on("select",function(){var e=s.state().get("selection").first().toJSON();t.find(".pgsfb-field-media-id").val(e.id),t.find(".pgsfb-field-media-src").val(e.url),t.find(".pgsfb-field-media-cover img").attr("src",e.url),t.find(".pgsfb-field-media-cover").removeClass("hidden"),t.find(".pgsfb-remove-media-button").removeClass("hidden")}),s.open()}),r(".color-picker").wpColorPicker(),r(document).on("click",".pgsfb-footer-configure, .pgsfb-element-settings-close",function(){r(".pgsfb-elements-settings").hasClass("pgsfb-elements-settings-show")?r(".pgsfb-elements-settings").removeClass("pgsfb-elements-settings-show"):r(".pgsfb-elements-settings").addClass("pgsfb-elements-settings-show")}),r(document).on("click",".pgsfb-save-configuration",function(e){r(".pgsfb-elements-settings").hasClass("pgsfb-elements-settings-show")&&r(".pgsfb-elements-settings").removeClass("pgsfb-elements-settings-show")}),r(document).on("click",".pgsfb-close-element",function(e){document.getElementById("pgsfb-footer-settings").reset(),r(".pgsfb-elements-settings").hasClass("pgsfb-elements-settings-show")&&r(".pgsfb-elements-settings").removeClass("pgsfb-elements-settings-show")}),r(document).on("click",".pgsfb-field-input",function(){var s=r(this).val(),e=r(this).attr("name"),o=r(".pgsfb-edit-tabs .pgsfb-tabs-title.pgsfb-tab-active").data("tab");r('[data-dependency-element="'+e+'"]').each(function(){var e=r(this).data("dependency-value"),t=r(this).data("content");-1==r.inArray(s,e)?r(this).hide():t==o&&r(this).show()})})})}(jQuery);